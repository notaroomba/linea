ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"linea.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "linea/src/linea.c"
  20              		.section	.rodata.linea_scan_for_pen.str1.4,"aMS",%progbits,1
  21              		.align	2
  22              	.LC0:
  23 0000 5B494E46 		.ascii	"[INFO]: \000"
  23      4F5D3A20 
  23      00
  24 0009 000000   		.align	2
  25              	.LC1:
  26 000c 50656E20 		.ascii	"Pen detected! X:%d, Y:%d, Sample:%d\000"
  26      64657465 
  26      63746564 
  26      2120583A 
  26      25642C20 
  27              		.section	.text.linea_scan_for_pen,"ax",%progbits
  28              		.align	1
  29              		.syntax unified
  30              		.thumb
  31              		.thumb_func
  33              	linea_scan_for_pen:
  34              	.LFB1419:
   1:linea/src/linea.c **** /*
   2:linea/src/linea.c **** * Project Linea
   3:linea/src/linea.c **** * Copyright (C) 2024 Anhang Li (thelithcore@gmail.com)
   4:linea/src/linea.c **** * Adapted for STM32WB55 by Nathan
   5:linea/src/linea.c **** *
   6:linea/src/linea.c **** * This program is free software: you can redistribute it and/or modify
   7:linea/src/linea.c **** * it under the terms of the GNU General Public License as published by
   8:linea/src/linea.c **** * the Free Software Foundation, either version 3 of the License, or
   9:linea/src/linea.c **** * (at your option) any later version.
  10:linea/src/linea.c **** *
  11:linea/src/linea.c **** * This program is distributed in the hope that it will be useful,
  12:linea/src/linea.c **** * but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:linea/src/linea.c **** * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:linea/src/linea.c **** * GNU General Public License for more details.
  15:linea/src/linea.c **** *
  16:linea/src/linea.c **** * You should have received a copy of the GNU General Public License
  17:linea/src/linea.c **** * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:linea/src/linea.c **** */
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 2


  19:linea/src/linea.c **** 
  20:linea/src/linea.c **** #include "linea_config.h"
  21:linea/src/linea.c **** #ifdef LINEA_PCB_LINEA_V1
  22:linea/src/linea.c **** 
  23:linea/src/linea.c **** #include "linea_bsp_linea_v1.h"
  24:linea/src/linea.c **** #include "main.h"
  25:linea/src/linea.c **** #include "math.h"
  26:linea/src/linea.c **** #include "linea_math.h"
  27:linea/src/linea.c **** #include "linea.h"
  28:linea/src/linea.c **** #include "BCG.h"
  29:linea/src/linea.c **** #include <stdint.h>
  30:linea/src/linea.c **** #include <stdbool.h>
  31:linea/src/linea.c **** 
  32:linea/src/linea.c **** // Function prototypes
  33:linea/src/linea.c **** static void linea_scan_for_pen(void);
  34:linea/src/linea.c **** static void linea_track_pen(void);
  35:linea/src/linea.c **** 
  36:linea/src/linea.c **** // Linea State Machine
  37:linea/src/linea.c **** static linea_FSM_t linea_fsm = LINEA_FSM_INIT;
  38:linea/src/linea.c **** static linea_debug_t linea_debug_mode = LINEA_DEBUG_NONE;
  39:linea/src/linea.c **** 
  40:linea/src/linea.c **** // Position tracking
  41:linea/src/linea.c **** static linea_position_t linea_pos_x = {0, 0.0f, true};
  42:linea/src/linea.c **** static linea_position_t linea_pos_y = {0, 0.0f, false};
  43:linea/src/linea.c **** 
  44:linea/src/linea.c **** // Frequency step tracking
  45:linea/src/linea.c **** static uint8_t linea_fstep = 0;
  46:linea/src/linea.c **** static float linea_freq = LINEA_TIM_F_CENTER;
  47:linea/src/linea.c **** 
  48:linea/src/linea.c **** // Initialize Linea system
  49:linea/src/linea.c **** void linea_init() {
  50:linea/src/linea.c ****     LINEA_UsrLog("Initializing Linea system...");
  51:linea/src/linea.c ****     
  52:linea/src/linea.c ****     // Initialize BSP
  53:linea/src/linea.c ****     linea_TIM_init();
  54:linea/src/linea.c ****     linea_ADC_init();
  55:linea/src/linea.c ****     
  56:linea/src/linea.c ****     // Initialize position tracking
  57:linea/src/linea.c ****     linea_pos_x.idx = 0;
  58:linea/src/linea.c ****     linea_pos_x.val = 0.0f;
  59:linea/src/linea.c ****     linea_pos_x.x_yn = true;
  60:linea/src/linea.c ****     
  61:linea/src/linea.c ****     linea_pos_y.idx = 0;
  62:linea/src/linea.c ****     linea_pos_y.val = 0.0f;
  63:linea/src/linea.c ****     linea_pos_y.x_yn = false;
  64:linea/src/linea.c ****     
  65:linea/src/linea.c ****     // Set initial frequency
  66:linea/src/linea.c ****     linea_set_freq(LINEA_TIM_F_CENTER);
  67:linea/src/linea.c ****     
  68:linea/src/linea.c ****     // Set initial state
  69:linea/src/linea.c ****     linea_fsm = LINEA_FSM_SEARCH;
  70:linea/src/linea.c ****     
  71:linea/src/linea.c ****     LINEA_UsrLog("Linea system initialized successfully");
  72:linea/src/linea.c **** }
  73:linea/src/linea.c **** 
  74:linea/src/linea.c **** // Main Linea cycle function
  75:linea/src/linea.c **** void linea_cycle() {
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 3


  76:linea/src/linea.c ****     switch(linea_fsm) {
  77:linea/src/linea.c ****         case LINEA_FSM_INIT:
  78:linea/src/linea.c ****             linea_init();
  79:linea/src/linea.c ****             break;
  80:linea/src/linea.c ****             
  81:linea/src/linea.c ****         case LINEA_FSM_SEARCH:
  82:linea/src/linea.c ****             // Scan for pen
  83:linea/src/linea.c ****             linea_scan_for_pen();
  84:linea/src/linea.c ****             break;
  85:linea/src/linea.c ****             
  86:linea/src/linea.c ****         case LINEA_FSM_LOCKED:
  87:linea/src/linea.c ****             // Track pen position
  88:linea/src/linea.c ****             linea_track_pen();
  89:linea/src/linea.c ****             break;
  90:linea/src/linea.c ****             
  91:linea/src/linea.c ****         default:
  92:linea/src/linea.c ****             LINEA_ErrLog("Invalid FSM state: %d", linea_fsm);
  93:linea/src/linea.c ****             linea_fsm = LINEA_FSM_INIT;
  94:linea/src/linea.c ****             break;
  95:linea/src/linea.c ****     }
  96:linea/src/linea.c **** }
  97:linea/src/linea.c **** 
  98:linea/src/linea.c **** // Set debug mode
  99:linea/src/linea.c **** void linea_set_mode(linea_debug_t mode) {
 100:linea/src/linea.c ****     linea_debug_mode = mode;
 101:linea/src/linea.c ****     LINEA_UsrLog("Debug mode set to: %d", mode);
 102:linea/src/linea.c **** }
 103:linea/src/linea.c **** 
 104:linea/src/linea.c **** // Get position for a specific frequency step
 105:linea/src/linea.c **** linea_position_t linea_get_position(uint8_t fstep, int lastpos, bool x_yn) {
 106:linea/src/linea.c ****     linea_position_t pos;
 107:linea/src/linea.c ****     
 108:linea/src/linea.c ****     if(x_yn) {
 109:linea/src/linea.c ****         pos = linea_pos_x;
 110:linea/src/linea.c ****     } else {
 111:linea/src/linea.c ****         pos = linea_pos_y;
 112:linea/src/linea.c ****     }
 113:linea/src/linea.c ****     
 114:linea/src/linea.c ****     // Update frequency step
 115:linea/src/linea.c ****     linea_fstep = fstep;
 116:linea/src/linea.c ****     linea_freq = LINEA_TIM_F_MIN + (fstep * LINEA_TIM_F_STEP);
 117:linea/src/linea.c ****     
 118:linea/src/linea.c ****     // Set frequency
 119:linea/src/linea.c ****     linea_set_freq(linea_freq);
 120:linea/src/linea.c ****     
 121:linea/src/linea.c ****     // Take sample
 122:linea/src/linea.c ****     uint16_t sample = linea_simple_take_sample(false, fstep);
 123:linea/src/linea.c ****     
 124:linea/src/linea.c ****     // Update position
 125:linea/src/linea.c ****     pos.val = (float)sample;
 126:linea/src/linea.c ****     
 127:linea/src/linea.c ****     return pos;
 128:linea/src/linea.c **** }
 129:linea/src/linea.c **** 
 130:linea/src/linea.c **** // Scan for pen
 131:linea/src/linea.c **** static void linea_scan_for_pen() {
  35              		.loc 1 131 34 view -0
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 4


  36              		.cfi_startproc
  37              		@ args = 0, pretend = 0, frame = 0
  38              		@ frame_needed = 0, uses_anonymous_args = 0
  39 0000 10B5     		push	{r4, lr}
  40              		.cfi_def_cfa_offset 8
  41              		.cfi_offset 4, -8
  42              		.cfi_offset 14, -4
 132:linea/src/linea.c ****     static uint8_t scan_step = 0;
  43              		.loc 1 132 5 view .LVU1
 133:linea/src/linea.c ****     static bool scanning_x = true;
  44              		.loc 1 133 5 view .LVU2
 134:linea/src/linea.c ****     
 135:linea/src/linea.c ****     // Select coil
 136:linea/src/linea.c ****     if(scanning_x) {
  45              		.loc 1 136 5 view .LVU3
  46              		.loc 1 136 8 is_stmt 0 view .LVU4
  47 0002 284B     		ldr	r3, .L13
  48 0004 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  49              		.loc 1 136 7 view .LVU5
  50 0006 FBB1     		cbz	r3, .L2
 137:linea/src/linea.c ****         linea_coil_select(scan_step, true);
  51              		.loc 1 137 9 is_stmt 1 view .LVU6
  52 0008 274C     		ldr	r4, .L13+4
  53 000a 0121     		movs	r1, #1
  54 000c 2078     		ldrb	r0, [r4]	@ zero_extendqisi2
  55 000e FFF7FEFF 		bl	linea_coil_select
  56              	.LVL0:
 138:linea/src/linea.c ****         linea_pos_x.idx = scan_step;
  57              		.loc 1 138 9 view .LVU7
  58              		.loc 1 138 25 is_stmt 0 view .LVU8
  59 0012 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
  60 0014 254B     		ldr	r3, .L13+8
  61 0016 1A60     		str	r2, [r3]
  62              	.L3:
 139:linea/src/linea.c ****     } else {
 140:linea/src/linea.c ****         linea_coil_select(scan_step, false);
 141:linea/src/linea.c ****         linea_pos_y.idx = scan_step;
 142:linea/src/linea.c ****     }
 143:linea/src/linea.c ****     
 144:linea/src/linea.c ****     // Take sample
 145:linea/src/linea.c ****     uint16_t sample = linea_simple_take_sample(false, linea_fstep);
  63              		.loc 1 145 5 is_stmt 1 view .LVU9
  64              		.loc 1 145 23 is_stmt 0 view .LVU10
  65 0018 254B     		ldr	r3, .L13+12
  66 001a 1978     		ldrb	r1, [r3]	@ zero_extendqisi2
  67 001c 0020     		movs	r0, #0
  68 001e FFF7FEFF 		bl	linea_simple_take_sample
  69              	.LVL1:
  70 0022 0446     		mov	r4, r0
  71              	.LVL2:
 146:linea/src/linea.c ****     
 147:linea/src/linea.c ****     // Check if pen is detected (threshold-based detection)
 148:linea/src/linea.c ****     if(sample > 100) { // Adjust threshold as needed
  72              		.loc 1 148 5 is_stmt 1 view .LVU11
  73              		.loc 1 148 7 is_stmt 0 view .LVU12
  74 0024 6428     		cmp	r0, #100
  75 0026 18D8     		bhi	.L12
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 5


 149:linea/src/linea.c ****         LINEA_UsrLog("Pen detected! X:%d, Y:%d, Sample:%d", 
 150:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 151:linea/src/linea.c ****                      scanning_x ? 0 : scan_step, 
 152:linea/src/linea.c ****                      sample);
 153:linea/src/linea.c ****         linea_fsm = LINEA_FSM_LOCKED;
 154:linea/src/linea.c ****         return;
 155:linea/src/linea.c ****     }
 156:linea/src/linea.c ****     
 157:linea/src/linea.c ****     // Move to next step
 158:linea/src/linea.c ****     scan_step++;
  76              		.loc 1 158 5 is_stmt 1 view .LVU13
  77              		.loc 1 158 14 is_stmt 0 view .LVU14
  78 0028 1F4A     		ldr	r2, .L13+4
  79 002a 1378     		ldrb	r3, [r2]	@ zero_extendqisi2
  80 002c 0133     		adds	r3, r3, #1
  81 002e DBB2     		uxtb	r3, r3
  82 0030 1370     		strb	r3, [r2]
 159:linea/src/linea.c ****     
 160:linea/src/linea.c ****     if(scanning_x && scan_step >= LINEA_N_X_COIL) {
  83              		.loc 1 160 5 is_stmt 1 view .LVU15
  84              		.loc 1 160 8 is_stmt 0 view .LVU16
  85 0032 1C4A     		ldr	r2, .L13
  86 0034 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  87              		.loc 1 160 7 view .LVU17
  88 0036 52B3     		cbz	r2, .L8
  89              		.loc 1 160 19 discriminator 1 view .LVU18
  90 0038 212B     		cmp	r3, #33
  91 003a 28D9     		bls	.L8
 161:linea/src/linea.c ****         scanning_x = false;
  92              		.loc 1 161 9 is_stmt 1 view .LVU19
  93              		.loc 1 161 20 is_stmt 0 view .LVU20
  94 003c 0023     		movs	r3, #0
  95 003e 194A     		ldr	r2, .L13
  96 0040 1370     		strb	r3, [r2]
 162:linea/src/linea.c ****         scan_step = 0;
  97              		.loc 1 162 9 is_stmt 1 view .LVU21
  98              		.loc 1 162 19 is_stmt 0 view .LVU22
  99 0042 194A     		ldr	r2, .L13+4
 100 0044 1370     		strb	r3, [r2]
 101 0046 1DE0     		b	.L1
 102              	.LVL3:
 103              	.L2:
 140:linea/src/linea.c ****         linea_pos_y.idx = scan_step;
 104              		.loc 1 140 9 is_stmt 1 view .LVU23
 105 0048 174C     		ldr	r4, .L13+4
 106 004a 0021     		movs	r1, #0
 107 004c 2078     		ldrb	r0, [r4]	@ zero_extendqisi2
 108 004e FFF7FEFF 		bl	linea_coil_select
 109              	.LVL4:
 141:linea/src/linea.c ****     }
 110              		.loc 1 141 9 view .LVU24
 141:linea/src/linea.c ****     }
 111              		.loc 1 141 25 is_stmt 0 view .LVU25
 112 0052 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 113 0054 174B     		ldr	r3, .L13+16
 114 0056 1A60     		str	r2, [r3]
 115 0058 DEE7     		b	.L3
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 6


 116              	.LVL5:
 117              	.L12:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 118              		.loc 1 149 9 is_stmt 1 view .LVU26
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 119              		.loc 1 149 9 view .LVU27
 120 005a 1748     		ldr	r0, .L13+20
 121              	.LVL6:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 122              		.loc 1 149 9 is_stmt 0 view .LVU28
 123 005c FFF7FEFF 		bl	printf
 124              	.LVL7:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 125              		.loc 1 149 9 is_stmt 1 discriminator 1 view .LVU29
 126 0060 104B     		ldr	r3, .L13
 127 0062 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 128 0064 7BB1     		cbz	r3, .L9
 129 0066 104A     		ldr	r2, .L13+4
 130 0068 1178     		ldrb	r1, [r2]	@ zero_extendqisi2
 131              	.L5:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 132              		.loc 1 149 9 is_stmt 0 discriminator 4 view .LVU30
 133 006a 73B9     		cbnz	r3, .L10
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 134              		.loc 1 149 9 discriminator 6 view .LVU31
 135 006c 0E4B     		ldr	r3, .L13+4
 136 006e 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 137              	.L6:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 138              		.loc 1 149 9 discriminator 8 view .LVU32
 139 0070 2346     		mov	r3, r4
 140 0072 1248     		ldr	r0, .L13+24
 141 0074 FFF7FEFF 		bl	printf
 142              	.LVL8:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 143              		.loc 1 149 9 is_stmt 1 discriminator 1 view .LVU33
 144 0078 0A20     		movs	r0, #10
 145 007a FFF7FEFF 		bl	putchar
 146              	.LVL9:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 147              		.loc 1 149 9 discriminator 2 view .LVU34
 153:linea/src/linea.c ****         return;
 148              		.loc 1 153 9 view .LVU35
 153:linea/src/linea.c ****         return;
 149              		.loc 1 153 19 is_stmt 0 view .LVU36
 150 007e 104B     		ldr	r3, .L13+28
 151 0080 0222     		movs	r2, #2
 152 0082 1A70     		strb	r2, [r3]
 154:linea/src/linea.c ****     }
 153              		.loc 1 154 9 is_stmt 1 view .LVU37
 154              	.L1:
 163:linea/src/linea.c ****     } else if(!scanning_x && scan_step >= LINEA_N_Y_COIL) {
 164:linea/src/linea.c ****         scanning_x = true;
 165:linea/src/linea.c ****         scan_step = 0;
 166:linea/src/linea.c ****     }
 167:linea/src/linea.c **** }
 155              		.loc 1 167 1 is_stmt 0 view .LVU38
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 7


 156 0084 10BD     		pop	{r4, pc}
 157              	.L9:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 158              		.loc 1 149 9 discriminator 2 view .LVU39
 159 0086 0021     		movs	r1, #0
 160 0088 EFE7     		b	.L5
 161              	.L10:
 149:linea/src/linea.c ****                      scanning_x ? scan_step : 0, 
 162              		.loc 1 149 9 discriminator 5 view .LVU40
 163 008a 0022     		movs	r2, #0
 164 008c F0E7     		b	.L6
 165              	.LVL10:
 166              	.L8:
 163:linea/src/linea.c ****     } else if(!scanning_x && scan_step >= LINEA_N_Y_COIL) {
 167              		.loc 1 163 12 is_stmt 1 view .LVU41
 163:linea/src/linea.c ****     } else if(!scanning_x && scan_step >= LINEA_N_Y_COIL) {
 168              		.loc 1 163 14 is_stmt 0 view .LVU42
 169 008e 002A     		cmp	r2, #0
 170 0090 F8D1     		bne	.L1
 163:linea/src/linea.c ****     } else if(!scanning_x && scan_step >= LINEA_N_Y_COIL) {
 171              		.loc 1 163 27 discriminator 1 view .LVU43
 172 0092 2C2B     		cmp	r3, #44
 173 0094 F6D9     		bls	.L1
 164:linea/src/linea.c ****         scan_step = 0;
 174              		.loc 1 164 9 is_stmt 1 view .LVU44
 164:linea/src/linea.c ****         scan_step = 0;
 175              		.loc 1 164 20 is_stmt 0 view .LVU45
 176 0096 034B     		ldr	r3, .L13
 177 0098 0122     		movs	r2, #1
 178 009a 1A70     		strb	r2, [r3]
 165:linea/src/linea.c ****     }
 179              		.loc 1 165 9 is_stmt 1 view .LVU46
 165:linea/src/linea.c ****     }
 180              		.loc 1 165 19 is_stmt 0 view .LVU47
 181 009c 024B     		ldr	r3, .L13+4
 182 009e 0022     		movs	r2, #0
 183 00a0 1A70     		strb	r2, [r3]
 184 00a2 EFE7     		b	.L1
 185              	.L14:
 186              		.align	2
 187              	.L13:
 188 00a4 00000000 		.word	scanning_x.1
 189 00a8 00000000 		.word	scan_step.0
 190 00ac 00000000 		.word	linea_pos_x
 191 00b0 00000000 		.word	linea_fstep
 192 00b4 00000000 		.word	linea_pos_y
 193 00b8 00000000 		.word	.LC0
 194 00bc 0C000000 		.word	.LC1
 195 00c0 00000000 		.word	linea_fsm
 196              		.cfi_endproc
 197              	.LFE1419:
 199              		.section	.rodata.linea_init.str1.4,"aMS",%progbits,1
 200              		.align	2
 201              	.LC2:
 202 0000 496E6974 		.ascii	"Initializing Linea system...\000"
 202      69616C69 
 202      7A696E67 
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 8


 202      204C696E 
 202      65612073 
 203 001d 000000   		.align	2
 204              	.LC3:
 205 0020 4C696E65 		.ascii	"Linea system initialized successfully\000"
 205      61207379 
 205      7374656D 
 205      20696E69 
 205      7469616C 
 206              		.section	.text.linea_init,"ax",%progbits
 207              		.align	1
 208              		.global	linea_init
 209              		.syntax unified
 210              		.thumb
 211              		.thumb_func
 213              	linea_init:
 214              	.LFB1415:
  49:linea/src/linea.c ****     LINEA_UsrLog("Initializing Linea system...");
 215              		.loc 1 49 19 is_stmt 1 view -0
 216              		.cfi_startproc
 217              		@ args = 0, pretend = 0, frame = 0
 218              		@ frame_needed = 0, uses_anonymous_args = 0
 219 0000 38B5     		push	{r3, r4, r5, lr}
 220              		.cfi_def_cfa_offset 16
 221              		.cfi_offset 3, -16
 222              		.cfi_offset 4, -12
 223              		.cfi_offset 5, -8
 224              		.cfi_offset 14, -4
  50:linea/src/linea.c ****     
 225              		.loc 1 50 5 view .LVU49
  50:linea/src/linea.c ****     
 226              		.loc 1 50 5 view .LVU50
 227 0002 144C     		ldr	r4, .L17
 228 0004 2046     		mov	r0, r4
 229 0006 FFF7FEFF 		bl	printf
 230              	.LVL11:
  50:linea/src/linea.c ****     
 231              		.loc 1 50 5 discriminator 1 view .LVU51
 232 000a 1348     		ldr	r0, .L17+4
 233 000c FFF7FEFF 		bl	printf
 234              	.LVL12:
  50:linea/src/linea.c ****     
 235              		.loc 1 50 5 discriminator 2 view .LVU52
 236 0010 0A20     		movs	r0, #10
 237 0012 FFF7FEFF 		bl	putchar
 238              	.LVL13:
  50:linea/src/linea.c ****     
 239              		.loc 1 50 5 discriminator 3 view .LVU53
  53:linea/src/linea.c ****     linea_ADC_init();
 240              		.loc 1 53 5 view .LVU54
 241 0016 FFF7FEFF 		bl	linea_TIM_init
 242              	.LVL14:
  54:linea/src/linea.c ****     
 243              		.loc 1 54 5 view .LVU55
 244 001a FFF7FEFF 		bl	linea_ADC_init
 245              	.LVL15:
  57:linea/src/linea.c ****     linea_pos_x.val = 0.0f;
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 9


 246              		.loc 1 57 5 view .LVU56
  57:linea/src/linea.c ****     linea_pos_x.val = 0.0f;
 247              		.loc 1 57 21 is_stmt 0 view .LVU57
 248 001e 0F4B     		ldr	r3, .L17+8
 249 0020 0022     		movs	r2, #0
 250 0022 1A60     		str	r2, [r3]
  58:linea/src/linea.c ****     linea_pos_x.x_yn = true;
 251              		.loc 1 58 5 is_stmt 1 view .LVU58
  58:linea/src/linea.c ****     linea_pos_x.x_yn = true;
 252              		.loc 1 58 21 is_stmt 0 view .LVU59
 253 0024 0021     		movs	r1, #0
 254 0026 5960     		str	r1, [r3, #4]	@ float
  59:linea/src/linea.c ****     
 255              		.loc 1 59 5 is_stmt 1 view .LVU60
  59:linea/src/linea.c ****     
 256              		.loc 1 59 22 is_stmt 0 view .LVU61
 257 0028 0125     		movs	r5, #1
 258 002a 1D72     		strb	r5, [r3, #8]
  61:linea/src/linea.c ****     linea_pos_y.val = 0.0f;
 259              		.loc 1 61 5 is_stmt 1 view .LVU62
  61:linea/src/linea.c ****     linea_pos_y.val = 0.0f;
 260              		.loc 1 61 21 is_stmt 0 view .LVU63
 261 002c 0C4B     		ldr	r3, .L17+12
 262 002e 1A60     		str	r2, [r3]
  62:linea/src/linea.c ****     linea_pos_y.x_yn = false;
 263              		.loc 1 62 5 is_stmt 1 view .LVU64
  62:linea/src/linea.c ****     linea_pos_y.x_yn = false;
 264              		.loc 1 62 21 is_stmt 0 view .LVU65
 265 0030 5960     		str	r1, [r3, #4]	@ float
  63:linea/src/linea.c ****     
 266              		.loc 1 63 5 is_stmt 1 view .LVU66
  63:linea/src/linea.c ****     
 267              		.loc 1 63 22 is_stmt 0 view .LVU67
 268 0032 1A72     		strb	r2, [r3, #8]
  66:linea/src/linea.c ****     
 269              		.loc 1 66 5 is_stmt 1 view .LVU68
 270 0034 9FED0B0A 		vldr.32	s0, .L17+16
 271 0038 FFF7FEFF 		bl	linea_set_freq
 272              	.LVL16:
  69:linea/src/linea.c ****     
 273              		.loc 1 69 5 view .LVU69
  69:linea/src/linea.c ****     
 274              		.loc 1 69 15 is_stmt 0 view .LVU70
 275 003c 0A4B     		ldr	r3, .L17+20
 276 003e 1D70     		strb	r5, [r3]
  71:linea/src/linea.c **** }
 277              		.loc 1 71 5 is_stmt 1 view .LVU71
  71:linea/src/linea.c **** }
 278              		.loc 1 71 5 view .LVU72
 279 0040 2046     		mov	r0, r4
 280 0042 FFF7FEFF 		bl	printf
 281              	.LVL17:
  71:linea/src/linea.c **** }
 282              		.loc 1 71 5 discriminator 1 view .LVU73
 283 0046 0948     		ldr	r0, .L17+24
 284 0048 FFF7FEFF 		bl	printf
 285              	.LVL18:
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 10


  71:linea/src/linea.c **** }
 286              		.loc 1 71 5 discriminator 2 view .LVU74
 287 004c 0A20     		movs	r0, #10
 288 004e FFF7FEFF 		bl	putchar
 289              	.LVL19:
  71:linea/src/linea.c **** }
 290              		.loc 1 71 5 discriminator 3 view .LVU75
  72:linea/src/linea.c **** 
 291              		.loc 1 72 1 is_stmt 0 view .LVU76
 292 0052 38BD     		pop	{r3, r4, r5, pc}
 293              	.L18:
 294              		.align	2
 295              	.L17:
 296 0054 00000000 		.word	.LC0
 297 0058 00000000 		.word	.LC2
 298 005c 00000000 		.word	linea_pos_x
 299 0060 00000000 		.word	linea_pos_y
 300 0064 0024F448 		.word	1223959552
 301 0068 00000000 		.word	linea_fsm
 302 006c 20000000 		.word	.LC3
 303              		.cfi_endproc
 304              	.LFE1415:
 306              		.section	.rodata.linea_set_mode.str1.4,"aMS",%progbits,1
 307              		.align	2
 308              	.LC4:
 309 0000 44656275 		.ascii	"Debug mode set to: %d\000"
 309      67206D6F 
 309      64652073 
 309      65742074 
 309      6F3A2025 
 310              		.section	.text.linea_set_mode,"ax",%progbits
 311              		.align	1
 312              		.global	linea_set_mode
 313              		.syntax unified
 314              		.thumb
 315              		.thumb_func
 317              	linea_set_mode:
 318              	.LVL20:
 319              	.LFB1417:
  99:linea/src/linea.c ****     linea_debug_mode = mode;
 320              		.loc 1 99 41 is_stmt 1 view -0
 321              		.cfi_startproc
 322              		@ args = 0, pretend = 0, frame = 0
 323              		@ frame_needed = 0, uses_anonymous_args = 0
  99:linea/src/linea.c ****     linea_debug_mode = mode;
 324              		.loc 1 99 41 is_stmt 0 view .LVU78
 325 0000 10B5     		push	{r4, lr}
 326              		.cfi_def_cfa_offset 8
 327              		.cfi_offset 4, -8
 328              		.cfi_offset 14, -4
 329 0002 0446     		mov	r4, r0
 100:linea/src/linea.c ****     LINEA_UsrLog("Debug mode set to: %d", mode);
 330              		.loc 1 100 5 is_stmt 1 view .LVU79
 100:linea/src/linea.c ****     LINEA_UsrLog("Debug mode set to: %d", mode);
 331              		.loc 1 100 22 is_stmt 0 view .LVU80
 332 0004 064B     		ldr	r3, .L21
 333 0006 1870     		strb	r0, [r3]
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 11


 101:linea/src/linea.c **** }
 334              		.loc 1 101 5 is_stmt 1 view .LVU81
 101:linea/src/linea.c **** }
 335              		.loc 1 101 5 view .LVU82
 336 0008 0648     		ldr	r0, .L21+4
 337              	.LVL21:
 101:linea/src/linea.c **** }
 338              		.loc 1 101 5 is_stmt 0 view .LVU83
 339 000a FFF7FEFF 		bl	printf
 340              	.LVL22:
 101:linea/src/linea.c **** }
 341              		.loc 1 101 5 is_stmt 1 discriminator 1 view .LVU84
 342 000e 2146     		mov	r1, r4
 343 0010 0548     		ldr	r0, .L21+8
 344 0012 FFF7FEFF 		bl	printf
 345              	.LVL23:
 101:linea/src/linea.c **** }
 346              		.loc 1 101 5 discriminator 2 view .LVU85
 347 0016 0A20     		movs	r0, #10
 348 0018 FFF7FEFF 		bl	putchar
 349              	.LVL24:
 101:linea/src/linea.c **** }
 350              		.loc 1 101 5 discriminator 3 view .LVU86
 102:linea/src/linea.c **** 
 351              		.loc 1 102 1 is_stmt 0 view .LVU87
 352 001c 10BD     		pop	{r4, pc}
 353              	.LVL25:
 354              	.L22:
 102:linea/src/linea.c **** 
 355              		.loc 1 102 1 view .LVU88
 356 001e 00BF     		.align	2
 357              	.L21:
 358 0020 00000000 		.word	linea_debug_mode
 359 0024 00000000 		.word	.LC0
 360 0028 00000000 		.word	.LC4
 361              		.cfi_endproc
 362              	.LFE1417:
 364              		.section	.text.linea_get_position,"ax",%progbits
 365              		.align	1
 366              		.global	linea_get_position
 367              		.syntax unified
 368              		.thumb
 369              		.thumb_func
 371              	linea_get_position:
 372              	.LVL26:
 373              	.LFB1418:
 105:linea/src/linea.c ****     linea_position_t pos;
 374              		.loc 1 105 76 is_stmt 1 view -0
 375              		.cfi_startproc
 376              		@ args = 0, pretend = 0, frame = 0
 377              		@ frame_needed = 0, uses_anonymous_args = 0
 105:linea/src/linea.c ****     linea_position_t pos;
 378              		.loc 1 105 76 is_stmt 0 view .LVU90
 379 0000 38B5     		push	{r3, r4, r5, lr}
 380              		.cfi_def_cfa_offset 16
 381              		.cfi_offset 3, -16
 382              		.cfi_offset 4, -12
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 12


 383              		.cfi_offset 5, -8
 384              		.cfi_offset 14, -4
 385 0002 0446     		mov	r4, r0
 386 0004 0D46     		mov	r5, r1
 106:linea/src/linea.c ****     
 387              		.loc 1 106 5 is_stmt 1 view .LVU91
 108:linea/src/linea.c ****         pos = linea_pos_x;
 388              		.loc 1 108 5 view .LVU92
 108:linea/src/linea.c ****         pos = linea_pos_x;
 389              		.loc 1 108 7 is_stmt 0 view .LVU93
 390 0006 1BB3     		cbz	r3, .L24
 109:linea/src/linea.c ****     } else {
 391              		.loc 1 109 9 is_stmt 1 view .LVU94
 109:linea/src/linea.c ****     } else {
 392              		.loc 1 109 13 is_stmt 0 view .LVU95
 393 0008 144B     		ldr	r3, .L27
 394              	.LVL27:
 109:linea/src/linea.c ****     } else {
 395              		.loc 1 109 13 view .LVU96
 396 000a 93E80700 		ldm	r3, {r0, r1, r2}
 397              	.LVL28:
 109:linea/src/linea.c ****     } else {
 398              		.loc 1 109 13 view .LVU97
 399 000e 84E80700 		stm	r4, {r0, r1, r2}
 400              	.L25:
 115:linea/src/linea.c ****     linea_freq = LINEA_TIM_F_MIN + (fstep * LINEA_TIM_F_STEP);
 401              		.loc 1 115 5 is_stmt 1 view .LVU98
 115:linea/src/linea.c ****     linea_freq = LINEA_TIM_F_MIN + (fstep * LINEA_TIM_F_STEP);
 402              		.loc 1 115 17 is_stmt 0 view .LVU99
 403 0012 134B     		ldr	r3, .L27+4
 404 0014 1D70     		strb	r5, [r3]
 116:linea/src/linea.c ****     
 405              		.loc 1 116 5 is_stmt 1 view .LVU100
 116:linea/src/linea.c ****     
 406              		.loc 1 116 43 is_stmt 0 view .LVU101
 407 0016 07EE905A 		vmov	s15, r5	@ int
 408 001a B8EEE70A 		vcvt.f32.s32	s0, s15
 409 001e DFED117A 		vldr.32	s15, .L27+8
 410 0022 20EE270A 		vmul.f32	s0, s0, s15
 116:linea/src/linea.c ****     
 411              		.loc 1 116 34 view .LVU102
 412 0026 DFED107A 		vldr.32	s15, .L27+12
 413 002a 30EE270A 		vadd.f32	s0, s0, s15
 116:linea/src/linea.c ****     
 414              		.loc 1 116 16 view .LVU103
 415 002e 0F4B     		ldr	r3, .L27+16
 416 0030 83ED000A 		vstr.32	s0, [r3]
 119:linea/src/linea.c ****     
 417              		.loc 1 119 5 is_stmt 1 view .LVU104
 418 0034 FFF7FEFF 		bl	linea_set_freq
 419              	.LVL29:
 122:linea/src/linea.c ****     
 420              		.loc 1 122 5 view .LVU105
 122:linea/src/linea.c ****     
 421              		.loc 1 122 23 is_stmt 0 view .LVU106
 422 0038 2946     		mov	r1, r5
 423 003a 0020     		movs	r0, #0
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 13


 424 003c FFF7FEFF 		bl	linea_simple_take_sample
 425              	.LVL30:
 426 0040 07EE900A 		vmov	s15, r0	@ int
 427              	.LVL31:
 125:linea/src/linea.c ****     
 428              		.loc 1 125 5 is_stmt 1 view .LVU107
 125:linea/src/linea.c ****     
 429              		.loc 1 125 15 is_stmt 0 view .LVU108
 430 0044 F8EE677A 		vcvt.f32.u32	s15, s15
 431              	.LVL32:
 125:linea/src/linea.c ****     
 432              		.loc 1 125 13 view .LVU109
 433 0048 C4ED017A 		vstr.32	s15, [r4, #4]
 127:linea/src/linea.c **** }
 434              		.loc 1 127 5 is_stmt 1 view .LVU110
 128:linea/src/linea.c **** 
 435              		.loc 1 128 1 is_stmt 0 view .LVU111
 436 004c 2046     		mov	r0, r4
 437 004e 38BD     		pop	{r3, r4, r5, pc}
 438              	.LVL33:
 439              	.L24:
 111:linea/src/linea.c ****     }
 440              		.loc 1 111 9 is_stmt 1 view .LVU112
 111:linea/src/linea.c ****     }
 441              		.loc 1 111 13 is_stmt 0 view .LVU113
 442 0050 074B     		ldr	r3, .L27+20
 443              	.LVL34:
 111:linea/src/linea.c ****     }
 444              		.loc 1 111 13 view .LVU114
 445 0052 93E80700 		ldm	r3, {r0, r1, r2}
 446              	.LVL35:
 111:linea/src/linea.c ****     }
 447              		.loc 1 111 13 view .LVU115
 448 0056 84E80700 		stm	r4, {r0, r1, r2}
 449 005a DAE7     		b	.L25
 450              	.L28:
 451              		.align	2
 452              	.L27:
 453 005c 00000000 		.word	linea_pos_x
 454 0060 00000000 		.word	linea_fstep
 455 0064 00504347 		.word	1195593728
 456 0068 0050C347 		.word	1203982336
 457 006c 00000000 		.word	linea_freq
 458 0070 00000000 		.word	linea_pos_y
 459              		.cfi_endproc
 460              	.LFE1418:
 462              		.section	.rodata.linea_track_pen.str1.4,"aMS",%progbits,1
 463              		.align	2
 464              	.LC5:
 465 0000 50656E20 		.ascii	"Pen lost, returning to search mode\000"
 465      6C6F7374 
 465      2C207265 
 465      7475726E 
 465      696E6720 
 466              		.section	.text.linea_track_pen,"ax",%progbits
 467              		.align	1
 468              		.syntax unified
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 14


 469              		.thumb
 470              		.thumb_func
 472              	linea_track_pen:
 473              	.LFB1420:
 168:linea/src/linea.c **** 
 169:linea/src/linea.c **** // Track pen position
 170:linea/src/linea.c **** static void linea_track_pen() {
 474              		.loc 1 170 31 is_stmt 1 view -0
 475              		.cfi_startproc
 476              		@ args = 0, pretend = 0, frame = 40
 477              		@ frame_needed = 0, uses_anonymous_args = 0
 478 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 479              		.cfi_def_cfa_offset 24
 480              		.cfi_offset 4, -24
 481              		.cfi_offset 5, -20
 482              		.cfi_offset 6, -16
 483              		.cfi_offset 7, -12
 484              		.cfi_offset 8, -8
 485              		.cfi_offset 14, -4
 486 0004 2DED028B 		vpush.64	{d8}
 487              		.cfi_def_cfa_offset 32
 488              		.cfi_offset 80, -32
 489              		.cfi_offset 81, -28
 490 0008 8AB0     		sub	sp, sp, #40
 491              		.cfi_def_cfa_offset 72
 171:linea/src/linea.c ****     // Get current position
 172:linea/src/linea.c ****     linea_position_t x_pos = linea_get_position(linea_fstep, linea_pos_x.idx, true);
 492              		.loc 1 172 5 view .LVU117
 493              		.loc 1 172 30 is_stmt 0 view .LVU118
 494 000a 07AF     		add	r7, sp, #28
 495 000c 304E     		ldr	r6, .L37
 496 000e DFF8D880 		ldr	r8, .L37+24
 497 0012 0123     		movs	r3, #1
 498 0014 3268     		ldr	r2, [r6]
 499 0016 98F80010 		ldrb	r1, [r8]	@ zero_extendqisi2
 500 001a 3846     		mov	r0, r7
 501 001c FFF7FEFF 		bl	linea_get_position
 502              	.LVL36:
 173:linea/src/linea.c ****     linea_position_t y_pos = linea_get_position(linea_fstep, linea_pos_y.idx, false);
 503              		.loc 1 173 5 is_stmt 1 view .LVU119
 504              		.loc 1 173 30 is_stmt 0 view .LVU120
 505 0020 04AD     		add	r5, sp, #16
 506 0022 2C4C     		ldr	r4, .L37+4
 507 0024 0023     		movs	r3, #0
 508 0026 2268     		ldr	r2, [r4]
 509 0028 98F80010 		ldrb	r1, [r8]	@ zero_extendqisi2
 510 002c 2846     		mov	r0, r5
 511 002e FFF7FEFF 		bl	linea_get_position
 512              	.LVL37:
 174:linea/src/linea.c ****     
 175:linea/src/linea.c ****     // Update stored positions
 176:linea/src/linea.c ****     linea_pos_x = x_pos;
 513              		.loc 1 176 5 is_stmt 1 view .LVU121
 514              		.loc 1 176 17 is_stmt 0 view .LVU122
 515 0032 97E80700 		ldm	r7, {r0, r1, r2}
 516 0036 86E80700 		stm	r6, {r0, r1, r2}
 177:linea/src/linea.c ****     linea_pos_y = y_pos;
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 15


 517              		.loc 1 177 5 is_stmt 1 view .LVU123
 518              		.loc 1 177 17 is_stmt 0 view .LVU124
 519 003a 95E80700 		ldm	r5, {r0, r1, r2}
 520 003e 84E80700 		stm	r4, {r0, r1, r2}
 178:linea/src/linea.c ****     
 179:linea/src/linea.c ****     // Create report
 180:linea/src/linea.c ****     linea_report_t report;
 521              		.loc 1 180 5 is_stmt 1 view .LVU125
 181:linea/src/linea.c ****     report.xpos = (uint16_t)(x_pos.val * 10); // Scale as needed
 522              		.loc 1 181 5 view .LVU126
 523              		.loc 1 181 35 is_stmt 0 view .LVU127
 524 0042 9DED088A 		vldr.32	s16, [sp, #32]
 525              		.loc 1 181 40 view .LVU128
 526 0046 F2EE047A 		vmov.f32	s15, #1.0e+1
 527 004a 28EE277A 		vmul.f32	s14, s16, s15
 528              		.loc 1 181 19 view .LVU129
 529 004e BCEEC77A 		vcvt.u32.f32	s14, s14
 530              		.loc 1 181 17 view .LVU130
 531 0052 17EE103A 		vmov	r3, s14	@ int
 532 0056 ADF80030 		strh	r3, [sp]	@ movhi
 182:linea/src/linea.c ****     report.ypos = (uint16_t)(y_pos.val * 10); // Scale as needed
 533              		.loc 1 182 5 is_stmt 1 view .LVU131
 534              		.loc 1 182 35 is_stmt 0 view .LVU132
 535 005a DDED058A 		vldr.32	s17, [sp, #20]
 536              		.loc 1 182 40 view .LVU133
 537 005e 68EEA77A 		vmul.f32	s15, s17, s15
 538              		.loc 1 182 19 view .LVU134
 539 0062 FCEEE77A 		vcvt.u32.f32	s15, s15
 540              		.loc 1 182 17 view .LVU135
 541 0066 17EE903A 		vmov	r3, s15	@ int
 542 006a ADF80230 		strh	r3, [sp, #2]	@ movhi
 183:linea/src/linea.c ****     report.tip = 1000; // Default pressure
 543              		.loc 1 183 5 is_stmt 1 view .LVU136
 544              		.loc 1 183 16 is_stmt 0 view .LVU137
 545 006e 4FF47A73 		mov	r3, #1000
 546 0072 ADF80A30 		strh	r3, [sp, #10]	@ movhi
 184:linea/src/linea.c ****     report.xtilt = 0;
 547              		.loc 1 184 5 is_stmt 1 view .LVU138
 548              		.loc 1 184 18 is_stmt 0 view .LVU139
 549 0076 0023     		movs	r3, #0
 550 0078 ADF80430 		strh	r3, [sp, #4]	@ movhi
 185:linea/src/linea.c ****     report.ytilt = 0;
 551              		.loc 1 185 5 is_stmt 1 view .LVU140
 552              		.loc 1 185 18 is_stmt 0 view .LVU141
 553 007c ADF80630 		strh	r3, [sp, #6]	@ movhi
 186:linea/src/linea.c ****     report.rotate = 0;
 554              		.loc 1 186 5 is_stmt 1 view .LVU142
 555              		.loc 1 186 19 is_stmt 0 view .LVU143
 556 0080 ADF80830 		strh	r3, [sp, #8]	@ movhi
 187:linea/src/linea.c ****     report.tail = 0;
 557              		.loc 1 187 5 is_stmt 1 view .LVU144
 558              		.loc 1 187 17 is_stmt 0 view .LVU145
 559 0084 ADF80C30 		strh	r3, [sp, #12]	@ movhi
 188:linea/src/linea.c ****     report.keys = 0;
 560              		.loc 1 188 5 is_stmt 1 view .LVU146
 561              		.loc 1 188 17 is_stmt 0 view .LVU147
 562 0088 ADF80E30 		strh	r3, [sp, #14]	@ movhi
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 16


 189:linea/src/linea.c ****     
 190:linea/src/linea.c ****     // Transmit report
 191:linea/src/linea.c ****     linea_transmit(&report);
 563              		.loc 1 191 5 is_stmt 1 view .LVU148
 564 008c 6846     		mov	r0, sp
 565 008e FFF7FEFF 		bl	linea_transmit
 566              	.LVL38:
 192:linea/src/linea.c ****     
 193:linea/src/linea.c ****     // Check if pen is still detected
 194:linea/src/linea.c ****     if(x_pos.val < 50 && y_pos.val < 50) { // Adjust threshold as needed
 567              		.loc 1 194 5 view .LVU149
 568              		.loc 1 194 7 is_stmt 0 view .LVU150
 569 0092 DFED117A 		vldr.32	s15, .L37+8
 570 0096 B4EEE78A 		vcmpe.f32	s16, s15
 571 009a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 572 009e 04D5     		bpl	.L29
 573              		.loc 1 194 23 discriminator 1 view .LVU151
 574 00a0 F4EEE78A 		vcmpe.f32	s17, s15
 575 00a4 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 576 00a8 04D4     		bmi	.L36
 577              	.L29:
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 196:linea/src/linea.c ****         linea_fsm = LINEA_FSM_SEARCH;
 197:linea/src/linea.c ****     }
 198:linea/src/linea.c **** }
 578              		.loc 1 198 1 view .LVU152
 579 00aa 0AB0     		add	sp, sp, #40
 580              		.cfi_remember_state
 581              		.cfi_def_cfa_offset 32
 582              		@ sp needed
 583 00ac BDEC028B 		vldm	sp!, {d8}
 584              		.cfi_restore 80
 585              		.cfi_restore 81
 586              		.cfi_def_cfa_offset 24
 587 00b0 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 588              	.L36:
 589              		.cfi_restore_state
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 590              		.loc 1 195 9 is_stmt 1 view .LVU153
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 591              		.loc 1 195 9 view .LVU154
 592 00b4 0948     		ldr	r0, .L37+12
 593 00b6 FFF7FEFF 		bl	printf
 594              	.LVL39:
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 595              		.loc 1 195 9 discriminator 1 view .LVU155
 596 00ba 0948     		ldr	r0, .L37+16
 597 00bc FFF7FEFF 		bl	printf
 598              	.LVL40:
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 599              		.loc 1 195 9 discriminator 2 view .LVU156
 600 00c0 0A20     		movs	r0, #10
 601 00c2 FFF7FEFF 		bl	putchar
 602              	.LVL41:
 195:linea/src/linea.c ****         LINEA_UsrLog("Pen lost, returning to search mode");
 603              		.loc 1 195 9 discriminator 3 view .LVU157
 196:linea/src/linea.c ****     }
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 17


 604              		.loc 1 196 9 view .LVU158
 196:linea/src/linea.c ****     }
 605              		.loc 1 196 19 is_stmt 0 view .LVU159
 606 00c6 074B     		ldr	r3, .L37+20
 607 00c8 0122     		movs	r2, #1
 608 00ca 1A70     		strb	r2, [r3]
 609              		.loc 1 198 1 view .LVU160
 610 00cc EDE7     		b	.L29
 611              	.L38:
 612 00ce 00BF     		.align	2
 613              	.L37:
 614 00d0 00000000 		.word	linea_pos_x
 615 00d4 00000000 		.word	linea_pos_y
 616 00d8 00004842 		.word	1112014848
 617 00dc 00000000 		.word	.LC0
 618 00e0 00000000 		.word	.LC5
 619 00e4 00000000 		.word	linea_fsm
 620 00e8 00000000 		.word	linea_fstep
 621              		.cfi_endproc
 622              	.LFE1420:
 624              		.section	.text.linea_cycle,"ax",%progbits
 625              		.align	1
 626              		.global	linea_cycle
 627              		.syntax unified
 628              		.thumb
 629              		.thumb_func
 631              	linea_cycle:
 632              	.LFB1416:
  75:linea/src/linea.c ****     switch(linea_fsm) {
 633              		.loc 1 75 20 is_stmt 1 view -0
 634              		.cfi_startproc
 635              		@ args = 0, pretend = 0, frame = 0
 636              		@ frame_needed = 0, uses_anonymous_args = 0
 637 0000 08B5     		push	{r3, lr}
 638              		.cfi_def_cfa_offset 8
 639              		.cfi_offset 3, -8
 640              		.cfi_offset 14, -4
  76:linea/src/linea.c ****         case LINEA_FSM_INIT:
 641              		.loc 1 76 5 view .LVU162
 642 0002 0A4B     		ldr	r3, .L45
 643 0004 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 644 0006 012B     		cmp	r3, #1
 645 0008 05D0     		beq	.L40
 646 000a 022B     		cmp	r3, #2
 647 000c 06D0     		beq	.L41
 648 000e 43B9     		cbnz	r3, .L42
  78:linea/src/linea.c ****             break;
 649              		.loc 1 78 13 view .LVU163
 650 0010 FFF7FEFF 		bl	linea_init
 651              	.LVL42:
  79:linea/src/linea.c ****             
 652              		.loc 1 79 13 view .LVU164
 653              	.L39:
  96:linea/src/linea.c **** 
 654              		.loc 1 96 1 is_stmt 0 view .LVU165
 655 0014 08BD     		pop	{r3, pc}
 656              	.L40:
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 18


  83:linea/src/linea.c ****             break;
 657              		.loc 1 83 13 is_stmt 1 view .LVU166
 658 0016 FFF7FEFF 		bl	linea_scan_for_pen
 659              	.LVL43:
  84:linea/src/linea.c ****             
 660              		.loc 1 84 13 view .LVU167
 661 001a FBE7     		b	.L39
 662              	.L41:
  88:linea/src/linea.c ****             break;
 663              		.loc 1 88 13 view .LVU168
 664 001c FFF7FEFF 		bl	linea_track_pen
 665              	.LVL44:
  89:linea/src/linea.c ****             
 666              		.loc 1 89 13 view .LVU169
 667 0020 F8E7     		b	.L39
 668              	.L42:
  92:linea/src/linea.c ****             linea_fsm = LINEA_FSM_INIT;
 669              		.loc 1 92 61 view .LVU170
  93:linea/src/linea.c ****             break;
 670              		.loc 1 93 13 view .LVU171
  93:linea/src/linea.c ****             break;
 671              		.loc 1 93 23 is_stmt 0 view .LVU172
 672 0022 024B     		ldr	r3, .L45
 673 0024 0022     		movs	r2, #0
 674 0026 1A70     		strb	r2, [r3]
  94:linea/src/linea.c ****     }
 675              		.loc 1 94 13 is_stmt 1 view .LVU173
  96:linea/src/linea.c **** 
 676              		.loc 1 96 1 is_stmt 0 view .LVU174
 677 0028 F4E7     		b	.L39
 678              	.L46:
 679 002a 00BF     		.align	2
 680              	.L45:
 681 002c 00000000 		.word	linea_fsm
 682              		.cfi_endproc
 683              	.LFE1416:
 685              		.section	.bss.scan_step.0,"aw",%nobits
 688              	scan_step.0:
 689 0000 00       		.space	1
 690              		.section	.data.scanning_x.1,"aw"
 693              	scanning_x.1:
 694 0000 01       		.byte	1
 695              		.section	.bss.linea_freq,"aw",%nobits
 696              		.align	2
 699              	linea_freq:
 700 0000 00000000 		.space	4
 701              		.section	.bss.linea_fstep,"aw",%nobits
 704              	linea_fstep:
 705 0000 00       		.space	1
 706              		.section	.bss.linea_pos_y,"aw",%nobits
 707              		.align	2
 710              	linea_pos_y:
 711 0000 00000000 		.space	12
 711      00000000 
 711      00000000 
 712              		.section	.data.linea_pos_x,"aw"
 713              		.align	2
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 19


 716              	linea_pos_x:
 717 0000 00000000 		.word	0
 718 0004 00000000 		.word	0
 719 0008 01       		.byte	1
 720 0009 000000   		.space	3
 721              		.section	.bss.linea_debug_mode,"aw",%nobits
 724              	linea_debug_mode:
 725 0000 00       		.space	1
 726              		.section	.bss.linea_fsm,"aw",%nobits
 729              	linea_fsm:
 730 0000 00       		.space	1
 731              		.text
 732              	.Letext0:
 733              		.file 2 "C:/PROGRAM FILES (X86)/ARM GNU TOOLCHAIN ARM-NONE-EABI/13.3 REL1/arm-none-eabi/include/ma
 734              		.file 3 "C:/PROGRAM FILES (X86)/ARM GNU TOOLCHAIN ARM-NONE-EABI/13.3 REL1/arm-none-eabi/include/sy
 735              		.file 4 "linea/inc/linea.h"
 736              		.file 5 "Core/Inc/app_conf.h"
 737              		.file 6 "linea/inc/linea_bsp_linea_v1.h"
 738              		.file 7 "C:/PROGRAM FILES (X86)/ARM GNU TOOLCHAIN ARM-NONE-EABI/13.3 REL1/arm-none-eabi/include/st
 739              		.file 8 "<built-in>"
ARM GAS  C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s 			page 20


DEFINED SYMBOLS
                            *ABS*:00000000 linea.c
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:21     .rodata.linea_scan_for_pen.str1.4:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:28     .text.linea_scan_for_pen:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:33     .text.linea_scan_for_pen:00000000 linea_scan_for_pen
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:188    .text.linea_scan_for_pen:000000a4 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:693    .data.scanning_x.1:00000000 scanning_x.1
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:688    .bss.scan_step.0:00000000 scan_step.0
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:716    .data.linea_pos_x:00000000 linea_pos_x
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:704    .bss.linea_fstep:00000000 linea_fstep
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:710    .bss.linea_pos_y:00000000 linea_pos_y
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:729    .bss.linea_fsm:00000000 linea_fsm
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:200    .rodata.linea_init.str1.4:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:207    .text.linea_init:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:213    .text.linea_init:00000000 linea_init
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:296    .text.linea_init:00000054 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:307    .rodata.linea_set_mode.str1.4:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:311    .text.linea_set_mode:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:317    .text.linea_set_mode:00000000 linea_set_mode
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:358    .text.linea_set_mode:00000020 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:724    .bss.linea_debug_mode:00000000 linea_debug_mode
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:365    .text.linea_get_position:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:371    .text.linea_get_position:00000000 linea_get_position
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:453    .text.linea_get_position:0000005c $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:699    .bss.linea_freq:00000000 linea_freq
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:463    .rodata.linea_track_pen.str1.4:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:467    .text.linea_track_pen:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:472    .text.linea_track_pen:00000000 linea_track_pen
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:614    .text.linea_track_pen:000000d0 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:625    .text.linea_cycle:00000000 $t
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:631    .text.linea_cycle:00000000 linea_cycle
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:681    .text.linea_cycle:0000002c $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:689    .bss.scan_step.0:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:696    .bss.linea_freq:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:705    .bss.linea_fstep:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:707    .bss.linea_pos_y:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:713    .data.linea_pos_x:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:725    .bss.linea_debug_mode:00000000 $d
C:\Users\Nathan\AppData\Local\Temp\ccQmIbHa.s:730    .bss.linea_fsm:00000000 $d

UNDEFINED SYMBOLS
linea_coil_select
linea_simple_take_sample
printf
putchar
linea_TIM_init
linea_ADC_init
linea_set_freq
linea_transmit
